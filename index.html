<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Transform AI-assisted writing into natural, human-sounding text. Detect and clean AI patterns, proofread by ear, and hit your word count targets.">
    <title>Humanize AI Text | Make AI Writing Sound Natural</title>

    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Humanize AI Text",
        "description": "Transform AI-assisted writing into natural, human-sounding text with pattern detection, cleaning, and audio proofreading.",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "AI pattern detection",
            "One-click humanization",
            "Text-to-speech proofreading",
            "Real-time word counting",
            "100% client-side processing"
        ]
    }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #FDFBF7;
            --bg-secondary: #F5F2EC;
            --bg-card: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #5C5C5C;
            --text-muted: #8A8A8A;
            --accent: #C45D3A;
            --accent-hover: #A84E30;
            --accent-light: rgba(196, 93, 58, 0.1);
            --border: #E5E2DC;
            --highlight-pattern: rgba(196, 93, 58, 0.2);
            --highlight-speech: rgba(255, 213, 79, 0.4);
            --success: #4A7C59;
            --success-light: rgba(74, 124, 89, 0.1);
            --warning: #B8860B;
            --warning-light: rgba(184, 134, 11, 0.1);
        }

        body {
            font-family: 'Source Sans 3', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-primary);
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header */
        header {
            padding: 48px 0 40px;
            text-align: center;
        }

        .eyebrow {
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 16px;
        }

        h1 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 400;
            line-height: 1.1;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        h1 em {
            font-style: italic;
        }

        .subtitle {
            font-size: 1.15rem;
            color: var(--text-secondary);
            max-width: 580px;
            margin: 0 auto 24px;
        }

        .trust-indicators {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .trust-indicators span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trust-indicators svg {
            width: 16px;
            height: 16px;
            stroke: var(--success);
        }

        /* Main Tool */
        .tool-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04);
        }

        /* Score Panel */
        .score-panel {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 32px;
            align-items: center;
            padding-bottom: 24px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .score-main {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .score-ring {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .score-ring svg {
            transform: rotate(-90deg);
            width: 80px;
            height: 80px;
        }

        .score-ring-bg {
            fill: none;
            stroke: var(--bg-secondary);
            stroke-width: 6;
        }

        .score-ring-fill {
            fill: none;
            stroke: var(--accent);
            stroke-width: 6;
            stroke-linecap: round;
            stroke-dasharray: 226;
            stroke-dashoffset: 226;
            transition: stroke-dashoffset 0.5s ease;
        }

        .score-ring-fill.low {
            stroke: var(--success);
        }

        .score-ring-fill.medium {
            stroke: var(--warning);
        }

        .score-ring-fill.high {
            stroke: var(--accent);
        }

        .score-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .score-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .score-info h3 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.4rem;
            font-weight: 400;
            margin-bottom: 4px;
        }

        .score-info p {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .stats-row {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 0 16px;
            border-left: 1px solid var(--border);
        }

        .stat-item:first-child {
            border-left: none;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Text Editor Area */
        .editor-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .text-display {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            font-family: 'Source Sans 3', sans-serif;
            font-size: 1rem;
            line-height: 1.8;
            color: transparent;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 12px;
            pointer-events: none;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow: auto;
        }

        .text-display .pattern {
            background: var(--highlight-pattern);
            border-radius: 2px;
            color: var(--text-primary);
        }

        .text-display .speech-highlight {
            background: var(--highlight-speech);
            border-radius: 2px;
            color: var(--text-primary);
        }

        textarea {
            width: 100%;
            min-height: 280px;
            padding: 20px;
            font-family: 'Source Sans 3', sans-serif;
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-primary);
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 12px;
            resize: vertical;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        textarea::placeholder {
            color: var(--text-muted);
        }

        textarea.highlighting-active {
            color: transparent;
            caret-color: var(--text-primary);
        }

        /* Pattern List */
        .patterns-found {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 16px 20px;
            margin-bottom: 20px;
        }

        .patterns-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .patterns-header h4 {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        .patterns-toggle {
            font-size: 0.85rem;
            color: var(--accent);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .patterns-toggle:hover {
            text-decoration: underline;
        }

        .patterns-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .pattern-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .pattern-tag:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .pattern-tag .count {
            background: var(--accent-light);
            color: var(--accent);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .patterns-empty {
            color: var(--success);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .patterns-empty svg {
            width: 18px;
            height: 18px;
        }

        .detection-settings {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
            user-select: none;
        }

        .toggle-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent);
        }

        .toggle-label:hover {
            color: var(--text-primary);
        }

        /* Action Buttons */
        .actions-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            font-family: 'Source Sans 3', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(196, 93, 58, 0.3);
        }

        .btn-primary:disabled {
            background: var(--border);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            padding: 12px 16px;
        }

        .btn-ghost:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .actions-divider {
            width: 1px;
            height: 32px;
            background: var(--border);
            margin: 0 8px;
        }

        /* Proofreading Controls */
        .proofread-section {
            border-top: 1px solid var(--border);
            padding-top: 20px;
            margin-top: 20px;
        }

        .proofread-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .proofread-header h4 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.1rem;
            font-weight: 400;
        }

        .proofread-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .playback-buttons {
            display: flex;
            gap: 4px;
        }

        .playback-btn {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .playback-btn svg {
            width: 18px;
            height: 18px;
            stroke: var(--text-secondary);
        }

        .playback-btn:hover:not(:disabled) {
            background: var(--border);
        }

        .playback-btn:hover:not(:disabled) svg {
            stroke: var(--text-primary);
        }

        .playback-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .speed-controls {
            display: flex;
            gap: 4px;
        }

        .speed-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            font-weight: 500;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            color: var(--text-secondary);
        }

        .speed-btn:hover {
            background: var(--border);
        }

        .speed-btn.active {
            background: var(--text-primary);
            border-color: var(--text-primary);
            color: white;
        }

        .voice-select {
            padding: 8px 12px;
            font-size: 0.9rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            max-width: 200px;
        }

        /* Preview Modal */
        .preview-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .preview-overlay.active {
            display: flex;
        }

        .preview-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-header h3 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.3rem;
            font-weight: 400;
        }

        .preview-close {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.15s;
        }

        .preview-close:hover {
            background: var(--bg-secondary);
        }

        .preview-close svg {
            width: 20px;
            height: 20px;
            stroke: var(--text-secondary);
        }

        .preview-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: var(--border);
            flex: 1;
            overflow: hidden;
        }

        .preview-column {
            background: var(--bg-card);
            padding: 20px;
            overflow: auto;
        }

        .preview-column h4 {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .preview-text {
            font-size: 0.95rem;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .preview-text del {
            background: rgba(196, 93, 58, 0.15);
            color: var(--accent);
            text-decoration: line-through;
        }

        .preview-text ins {
            background: var(--success-light);
            color: var(--success);
            text-decoration: none;
        }

        .preview-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .preview-stats {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Content Sections */
        .content-section {
            max-width: 720px;
            margin: 80px auto;
            padding: 0 24px;
        }

        .content-section h2 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .content-section h3 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.4rem;
            font-weight: 400;
            margin: 40px 0 16px;
            color: var(--text-primary);
        }

        .content-section p {
            margin-bottom: 16px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        /* How It Works */
        .how-it-works {
            background: var(--bg-secondary);
            padding: 80px 24px;
            margin: 60px 0;
        }

        .how-it-works h2 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 2rem;
            font-weight: 400;
            text-align: center;
            margin-bottom: 48px;
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 32px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .step {
            text-align: center;
        }

        .step-number {
            width: 48px;
            height: 48px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            margin: 0 auto 16px;
        }

        .step h4 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.15rem;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .step p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* FAQ */
        .faq-section {
            max-width: 720px;
            margin: 80px auto;
            padding: 0 24px;
        }

        .faq-section h2 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 2rem;
            font-weight: 400;
            text-align: center;
            margin-bottom: 48px;
        }

        .faq-item {
            border-bottom: 1px solid var(--border);
            padding: 24px 0;
        }

        .faq-question {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .faq-answer {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 48px 24px;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        footer p {
            margin-bottom: 8px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .score-panel {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .stats-row {
                justify-content: center;
            }

            .steps-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 24px;
            }

            .preview-body {
                grid-template-columns: 1fr;
            }

            .proofread-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .actions-divider {
                display: none;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 32px 0 24px;
            }

            .tool-container {
                padding: 20px;
            }

            .trust-indicators {
                flex-direction: column;
                gap: 8px;
            }

            .steps-grid {
                grid-template-columns: 1fr;
            }

            .actions-row {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <p class="eyebrow">Free Tool</p>
            <h1>Make AI writing sound <em>human</em></h1>
            <p class="subtitle">Paste your AI-assisted draft. Detect patterns that sound robotic. Clean them instantly. Proofread by ear. Ship with confidence.</p>
            <div class="trust-indicators">
                <span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    100% private, runs in your browser
                </span>
                <span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    Works offline once loaded
                </span>
                <span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5"/>
                    </svg>
                    No account required
                </span>
            </div>
        </header>

        <div class="tool-container">
            <!-- Score Panel -->
            <div class="score-panel">
                <div class="score-main">
                    <div class="score-ring">
                        <svg viewBox="0 0 80 80">
                            <circle class="score-ring-bg" cx="40" cy="40" r="36"/>
                            <circle class="score-ring-fill" id="scoreRing" cx="40" cy="40" r="36"/>
                        </svg>
                        <div class="score-number"><span id="aiScore">0</span>%</div>
                    </div>
                    <div class="score-info">
                        <h3 id="scoreLabel">Paste text to analyze</h3>
                        <p id="scoreDescription">We'll detect AI patterns and help you humanize your writing.</p>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-value" id="wordCount">0</span>
                        <span class="stat-label">Words</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="charCount">0</span>
                        <span class="stat-label">Characters</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="sentenceCount">0</span>
                        <span class="stat-label">Sentences</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="readingTime">0</span>
                        <span class="stat-label">Min read</span>
                    </div>
                </div>
            </div>

            <!-- Text Editor -->
            <div class="editor-wrapper">
                <div class="text-display" id="textDisplay"></div>
                <textarea id="textInput" placeholder="Paste your AI-assisted text here. We'll find patterns like overused phrases, em dashes, hedging language, and other signals that make text sound robotic..."></textarea>
            </div>

            <!-- Patterns Found -->
            <div class="patterns-found" id="patternsPanel">
                <div class="patterns-header">
                    <h4>Patterns Detected (<span id="patternCount">0</span>)</h4>
                    <button class="patterns-toggle" id="highlightToggle">Show in text</button>
                </div>
                <div class="patterns-list" id="patternsList">
                    <div class="patterns-empty" id="patternsEmpty">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        No patterns detected yet
                    </div>
                </div>
                <div class="detection-settings">
                    <label class="toggle-label">
                        <input type="checkbox" id="emDashToggle" checked>
                        <span>Detect & remove em dashes (â€”)</span>
                    </label>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="actions-row">
                <button class="btn btn-primary" id="cleanBtn" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                    </svg>
                    Humanize Text
                </button>
                <button class="btn btn-secondary" id="previewBtn" disabled>
                    Preview Changes
                </button>
                <button class="btn btn-ghost" id="undoBtn" disabled>
                    Undo
                </button>
                <div class="actions-divider"></div>
                <button class="btn btn-ghost" id="copyBtn" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                    Copy
                </button>
                <button class="btn btn-ghost" id="clearBtn">
                    Clear
                </button>
            </div>

            <!-- Proofreading Section -->
            <div class="proofread-section">
                <div class="proofread-header">
                    <h4>Proofread by ear</h4>
                </div>
                <div class="proofread-controls">
                    <div class="playback-buttons">
                        <button class="playback-btn" id="playBtn" title="Play">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                        </button>
                        <button class="playback-btn" id="pauseBtn" disabled title="Pause">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="6" y="4" width="4" height="16"/>
                                <rect x="14" y="4" width="4" height="16"/>
                            </svg>
                        </button>
                        <button class="playback-btn" id="stopBtn" disabled title="Stop">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="4" y="4" width="16" height="16"/>
                            </svg>
                        </button>
                    </div>
                    <div class="speed-controls">
                        <button class="speed-btn" data-speed="0.5">0.5x</button>
                        <button class="speed-btn" data-speed="0.75">0.75x</button>
                        <button class="speed-btn active" data-speed="1">1x</button>
                        <button class="speed-btn" data-speed="1.25">1.25x</button>
                        <button class="speed-btn" data-speed="1.5">1.5x</button>
                        <button class="speed-btn" data-speed="2">2x</button>
                    </div>
                    <select class="voice-select" id="voiceSelect"></select>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="preview-overlay" id="previewOverlay">
        <div class="preview-modal">
            <div class="preview-header">
                <h3>Preview Changes</h3>
                <button class="preview-close" id="previewClose">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="preview-body">
                <div class="preview-column">
                    <h4>Before</h4>
                    <div class="preview-text" id="previewBefore"></div>
                </div>
                <div class="preview-column">
                    <h4>After</h4>
                    <div class="preview-text" id="previewAfter"></div>
                </div>
            </div>
            <div class="preview-footer">
                <div class="preview-stats" id="previewStats"></div>
                <button class="btn btn-secondary" id="previewCancel">Cancel</button>
                <button class="btn btn-primary" id="previewApply">Apply Changes</button>
            </div>
        </div>
    </div>

    <!-- How It Works -->
    <section class="how-it-works">
        <h2>How it works</h2>
        <div class="steps-grid">
            <div class="step">
                <div class="step-number">1</div>
                <h4>Paste your draft</h4>
                <p>Drop in text from ChatGPT, Claude, or any AI assistant. Everything stays on your device.</p>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <h4>Review patterns</h4>
                <p>See exactly which phrases, punctuation, and structures flag as AI-generated.</p>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <h4>Humanize</h4>
                <p>One click replaces robotic patterns with natural alternatives. Preview before applying.</p>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <h4>Proofread by ear</h4>
                <p>Listen to your text read aloud. Catch awkward phrasing your eyes miss.</p>
            </div>
        </div>
    </section>

    <!-- Content Section -->
    <section class="content-section">
        <h2>Why AI-assisted writing needs a human pass</h2>
        <p>AI tools have transformed how we write. ChatGPT, Claude, and other assistants help us draft emails, reports, blog posts, and documents faster than ever. But they leave fingerprints.</p>
        <p>These fingerprints are patterns that trained readers, editors, and detection tools recognize: certain phrases that appear far more often in AI output than human writing, punctuation habits that reveal machine origins, and structural formulas that feel polished but impersonal.</p>
        <p>For students, these patterns can trigger plagiarism detectors. For professionals, they undermine credibility. For writers, they flatten voice and make everything sound the same.</p>
        
        <h3>What makes text sound like AI?</h3>
        <p>After analyzing thousands of AI-generated documents, we've identified the most reliable signals. Our tool detects overused vocabulary like "delve," "utilize," "robust," and "leverage" that AI models reach for disproportionately. We flag hedging phrases like "It's worth noting" and "generally speaking" that pad word counts without adding meaning.</p>
        <p>We also catch structural tells: excessive em dashes, colon overuse before lists, and the performative enthusiasm of "Great question!" openers. Even perfect punctuation can be a signal, as humans are messier writers than AI.</p>
        <p>The tool removes all emojis by default. AI tends to sprinkle them into contexts where no human professional would, undermining the credibility of business documents and formal writing.</p>
        
        <h3>The proofreading advantage</h3>
        <p>Reading your own writing silently, your brain autocorrects. You see what you meant, not what you wrote. Text-to-speech breaks this pattern by forcing you to experience your writing sequentially, the way your readers will.</p>
        <p>Awkward phrasing, repeated words, and sentences that look fine but sound clunky become immediately obvious when heard aloud. This is especially valuable after AI humanization, as you can verify the result sounds natural before publishing.</p>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
        <h2>Questions</h2>
        
        <div class="faq-item">
            <div class="faq-question">Is my text private?</div>
            <div class="faq-answer">Completely. All processing happens in your browser using JavaScript. Your text never leaves your device, is never sent to any server, and is never stored anywhere. You can use this tool offline once the page loads.</div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">What patterns does the tool detect?</div>
            <div class="faq-answer">We detect overused AI vocabulary (delve, utilize, robust, leverage, etc.), hedging phrases (it's worth noting, generally speaking), structural patterns (excessive em dashes, colon overuse), performative language (Great question!), semantic padding (In today's world), all emojis, and punctuation anomalies. The detection is weighted so stronger signals affect your score more.</div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Will this make my text undetectable by AI detectors?</div>
            <div class="faq-answer">This tool reduces common AI signals that detectors look for, but we cannot guarantee any text will pass all AI detection tools. The goal is to make your writing sound more natural and human, which correlates with lower AI detection scores but isn't the same thing.</div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Does the cleaning change my meaning?</div>
            <div class="faq-answer">The humanizer replaces flagged phrases with simpler alternatives and removes unnecessary elements. It preserves your meaning but changes your word choices. Always use the Preview feature to review changes before applying, and use the Undo button if you don't like the result.</div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Why are all emojis removed?</div>
            <div class="faq-answer">AI tools tend to insert emojis into contexts where human professionals wouldn't use them, particularly in business documents, academic writing, and formal communications. Rather than try to determine which emojis are "appropriate," we remove all of them. If you're writing for social media where emojis are expected, you can add them back after cleaning.</div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">How is the AI likelihood score calculated?</div>
            <div class="faq-answer">The score reflects the density and severity of detected patterns relative to your text length. High-confidence signals like "delve into" or excessive em dashes are weighted more heavily than weaker signals. A score under 20% is typical for human writing; above 50% suggests significant AI patterns.</div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Is this tool really free?</div>
            <div class="faq-answer">Yes. No registration, no limits, no premium tier. We built this as a public resource for writers navigating the AI-assisted writing era.</div>
        </div>
    </section>

    <footer>
        <p>Your text never leaves your browser. 100% client-side processing.</p>
        <p>&copy; 2025 Humanize AI Text. Built for writers.</p>
    </footer>

    <script>
        // Debounce utility
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        // ============================================
        // AI Pattern Detection - Comprehensive
        // ============================================
        
        const aiPatterns = {
            // High-confidence phrases (weight: 3)
            highConfidence: [
                'delve into', 'delve deeper', 'dive into', 'dive deep', 'deep dive',
                'it\'s worth noting', 'it is worth noting', 'it\'s important to note',
                'it is important to note', 'it\'s crucial to', 'it is crucial to',
                'at the end of the day', 'when all is said and done',
                'in today\'s world', 'in this day and age', 'in the modern era',
                'serves as a testament', 'stands as a testament',
                'game-changer', 'game changer', 'paradigm shift',
                'straightforward yet effective', 'simple yet powerful',
                'not only but also', 'elevate your', 'unlock the power',
                'navigating the', 'embark on', 'embark upon',
                'harness the power', 'unleash the potential',
                'the realm of', 'the landscape of', 'a myriad of',
                'multifaceted', 'ever-evolving', 'cutting-edge',
                'revolutionize', 'revolutionizing', 'transformative',
                'it goes without saying', 'needless to say',
                'plays a pivotal role', 'plays a crucial role'
            ],
            
            // Medium-confidence phrases (weight: 2)
            mediumConfidence: [
                'leverage', 'utilize', 'utilise', 'utilizing', 'utilising',
                'robust', 'streamline', 'streamlined', 'optimize', 'optimise',
                'seamless', 'seamlessly', 'comprehensive', 'holistic',
                'innovative', 'innovative solution', 'cutting edge', 'state-of-the-art',
                'moreover', 'furthermore', 'additionally', 'consequently',
                'in conclusion', 'in summary', 'to summarize', 'to sum up',
                'ultimately', 'essentially', 'fundamentally',
                'first and foremost', 'last but not least',
                'a wide range of', 'a variety of', 'a plethora of',
                'in terms of', 'with regard to', 'with respect to',
                'it should be noted', 'it must be noted',
                'generally speaking', 'broadly speaking',
                'that being said', 'with that being said', 'that said',
                'moving forward', 'going forward',
                'when it comes to', 'as it pertains to',
                'foster', 'fostering', 'cultivate', 'cultivating',
                'empower', 'empowering', 'facilitate', 'facilitating',
                'enhance', 'enhancing', 'bolster', 'bolstering',
                'paramount', 'pivotal', 'vital', 'crucial', 'essential',
                'meticulous', 'meticulously', 'intricate', 'nuanced',
                'underscore', 'underscores', 'underscoring',
                'landscape', 'paradigm', 'ecosystem', 'synergy',
                'actionable', 'scalable', 'impactful'
            ],
            
            // Low-confidence phrases (weight: 1)
            lowConfidence: [
                'the fact that', 'due to the fact', 'in order to',
                'on the other hand', 'by the same token',
                'for instance', 'for example', 'such as',
                'in other words', 'to put it simply',
                'as a result', 'as such', 'thus', 'hence', 'thereby',
                'whether you\'re', 'if you\'re looking',
                'let\'s', 'let us', 'here\'s', 'here is',
                'consider', 'imagine', 'picture this',
                'interestingly', 'notably', 'importantly', 'significantly',
                'overall', 'in general', 'on the whole',
                'in this article', 'in this post', 'in this guide',
                'take your', 'to the next level',
                'stands out', 'sets apart',
                'key', 'core', 'main', 'primary'
            ],

            // Performative enthusiasm (weight: 2)
            performative: [
                'great question', 'excellent question', 'good question',
                'that\'s a great', 'that\'s an excellent', 'that\'s a good',
                'i\'d be happy to', 'i\'m happy to', 'happy to help',
                'absolutely', 'certainly', 'definitely', 'indeed',
                'of course', 'sure thing', 'no problem'
            ],

            // Replacements for cleaning
            replacements: {
                'delve into': 'explore',
                'delve deeper': 'look closer',
                'dive into': 'examine',
                'dive deep': 'examine closely',
                'deep dive': 'detailed look',
                'it\'s worth noting': '',
                'it is worth noting': '',
                'it\'s important to note': '',
                'it is important to note': '',
                'it\'s crucial to': '',
                'it is crucial to': '',
                'at the end of the day': '',
                'when all is said and done': '',
                'in today\'s world': '',
                'in this day and age': '',
                'in the modern era': '',
                'serves as a testament': 'shows',
                'stands as a testament': 'shows',
                'game-changer': 'significant development',
                'game changer': 'significant development',
                'paradigm shift': 'major change',
                'leverage': 'use',
                'utilize': 'use',
                'utilise': 'use',
                'utilizing': 'using',
                'utilising': 'using',
                'robust': 'strong',
                'streamline': 'simplify',
                'streamlined': 'simplified',
                'optimize': 'improve',
                'optimise': 'improve',
                'seamless': 'smooth',
                'seamlessly': 'smoothly',
                'comprehensive': 'complete',
                'holistic': 'complete',
                'innovative': 'new',
                'cutting-edge': 'advanced',
                'cutting edge': 'advanced',
                'state-of-the-art': 'modern',
                'moreover': 'also',
                'furthermore': 'also',
                'additionally': 'also',
                'consequently': 'so',
                'in conclusion': '',
                'in summary': '',
                'to summarize': '',
                'to sum up': '',
                'ultimately': '',
                'essentially': '',
                'fundamentally': '',
                'first and foremost': 'first',
                'last but not least': 'finally',
                'a wide range of': 'many',
                'a variety of': 'various',
                'a plethora of': 'many',
                'in terms of': 'for',
                'with regard to': 'about',
                'with respect to': 'about',
                'it should be noted': '',
                'it must be noted': '',
                'generally speaking': '',
                'broadly speaking': '',
                'that being said': 'but',
                'with that being said': 'but',
                'that said': 'but',
                'moving forward': '',
                'going forward': '',
                'when it comes to': 'for',
                'as it pertains to': 'about',
                'foster': 'support',
                'fostering': 'supporting',
                'cultivate': 'build',
                'cultivating': 'building',
                'empower': 'help',
                'empowering': 'helping',
                'facilitate': 'help',
                'facilitating': 'helping',
                'enhance': 'improve',
                'enhancing': 'improving',
                'bolster': 'strengthen',
                'bolstering': 'strengthening',
                'paramount': 'important',
                'pivotal': 'key',
                'vital': 'important',
                'crucial': 'important',
                'essential': 'needed',
                'meticulous': 'careful',
                'meticulously': 'carefully',
                'intricate': 'complex',
                'nuanced': 'subtle',
                'underscore': 'highlight',
                'underscores': 'highlights',
                'underscoring': 'highlighting',
                'landscape': 'field',
                'paradigm': 'model',
                'ecosystem': 'system',
                'synergy': 'cooperation',
                'actionable': 'practical',
                'scalable': 'expandable',
                'impactful': 'effective',
                'it goes without saying': '',
                'needless to say': '',
                'plays a pivotal role': 'is key',
                'plays a crucial role': 'is important',
                'navigating the': 'understanding',
                'embark on': 'start',
                'embark upon': 'start',
                'harness the power': 'use',
                'unleash the potential': 'unlock',
                'the realm of': '',
                'the landscape of': '',
                'a myriad of': 'many',
                'multifaceted': 'complex',
                'ever-evolving': 'changing',
                'revolutionize': 'transform',
                'revolutionizing': 'transforming',
                'transformative': 'significant',
                'great question': '',
                'excellent question': '',
                'good question': '',
                'i\'d be happy to': '',
                'i\'m happy to': '',
                'happy to help': '',
                'straightforward yet effective': 'practical',
                'simple yet powerful': 'effective'
            }
        };

        // ============================================
        // DOM Elements
        // ============================================
        
        const textInput = document.getElementById('textInput');
        const textDisplay = document.getElementById('textDisplay');
        const wordCountEl = document.getElementById('wordCount');
        const charCountEl = document.getElementById('charCount');
        const sentenceCountEl = document.getElementById('sentenceCount');
        const readingTimeEl = document.getElementById('readingTime');
        const aiScoreEl = document.getElementById('aiScore');
        const scoreRing = document.getElementById('scoreRing');
        const scoreLabel = document.getElementById('scoreLabel');
        const scoreDescription = document.getElementById('scoreDescription');
        const patternCountEl = document.getElementById('patternCount');
        const patternsList = document.getElementById('patternsList');
        const patternsEmpty = document.getElementById('patternsEmpty');
        const highlightToggle = document.getElementById('highlightToggle');
        const emDashToggle = document.getElementById('emDashToggle');
        
        const cleanBtn = document.getElementById('cleanBtn');
        const previewBtn = document.getElementById('previewBtn');
        const undoBtn = document.getElementById('undoBtn');
        const copyBtn = document.getElementById('copyBtn');
        const clearBtn = document.getElementById('clearBtn');
        
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const voiceSelect = document.getElementById('voiceSelect');
        const speedBtns = document.querySelectorAll('.speed-btn');
        
        const previewOverlay = document.getElementById('previewOverlay');
        const previewBefore = document.getElementById('previewBefore');
        const previewAfter = document.getElementById('previewAfter');
        const previewStats = document.getElementById('previewStats');
        const previewClose = document.getElementById('previewClose');
        const previewCancel = document.getElementById('previewCancel');
        const previewApply = document.getElementById('previewApply');

        // State
        let textBeforeClean = '';
        let isHighlighting = false;
        let currentDetection = { patterns: {}, score: 0, total: 0 };
        let cleanedText = '';
        let detectEmDashes = localStorage.getItem('detectEmDashes') !== 'false'; // Default true

        // ============================================
        // Text Analysis
        // ============================================
        
        function analyzeText(text) {
            const trimmed = text.trim();
            const words = trimmed.split(/\s+/).filter(w => w.length > 0);
            const wordCount = trimmed.length > 0 ? words.length : 0;
            const charCount = text.length;
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const sentenceCount = sentences.length;
            const readingTime = Math.ceil(wordCount / 200);
            
            return { wordCount, charCount, sentenceCount, readingTime };
        }

        function detectPatterns(text) {
            const lowerText = text.toLowerCase();
            const patterns = {};
            let weightedScore = 0;
            let totalPatterns = 0;

            // Helper to find and count pattern
            function findPattern(phrase, weight, category) {
                const escaped = phrase.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp('\\b' + escaped + '\\b', 'gi');
                const matches = text.match(regex);
                if (matches) {
                    patterns[phrase] = { count: matches.length, weight, category };
                    weightedScore += matches.length * weight;
                    totalPatterns += matches.length;
                }
            }

            // Check all phrase categories
            aiPatterns.highConfidence.forEach(p => findPattern(p, 3, 'high'));
            aiPatterns.mediumConfidence.forEach(p => findPattern(p, 2, 'medium'));
            aiPatterns.lowConfidence.forEach(p => findPattern(p, 1, 'low'));
            aiPatterns.performative.forEach(p => findPattern(p, 2, 'performative'));

            // Check for em dash overuse (weight: 2 per occurrence after threshold)
            if (detectEmDashes) {
                const emDashes = (text.match(/â€”/g) || []).length;
                const words = text.trim().split(/\s+/).filter(w => w.length > 0).length;
                if (words > 50 && emDashes > 1) {
                    const emDashDensity = emDashes / (words / 100);
                    if (emDashDensity > 0.5) {
                        patterns['Em dashes (â€”)'] = { count: emDashes, weight: 2, category: 'punctuation' };
                        weightedScore += emDashes * 2;
                        totalPatterns += emDashes;
                    }
                }
            }

            // Check for colon overuse before lists
            const colonMatches = text.match(/:\s*\n/g) || [];
            if (colonMatches.length > 2) {
                patterns['Colons before lists'] = { count: colonMatches.length, weight: 1, category: 'punctuation' };
                weightedScore += colonMatches.length;
                totalPatterns += colonMatches.length;
            }

            // Check for emojis (flag all) - weight: 5 (high confidence AI signal)
            const emojiRegex = /[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F1FF}]|[\u{1F200}-\u{1F2FF}]|[\u{2B50}]|[\u{2B55}]|[\u{231A}-\u{231B}]|[\u{23E9}-\u{23F3}]|[\u{23F8}-\u{23FA}]|[\u{25AA}-\u{25AB}]|[\u{25B6}]|[\u{25C0}]|[\u{25FB}-\u{25FE}]|[\u{2614}-\u{2615}]|[\u{2648}-\u{2653}]|[\u{267F}]|[\u{2693}]|[\u{26A1}]|[\u{26AA}-\u{26AB}]|[\u{26BD}-\u{26BE}]|[\u{26C4}-\u{26C5}]|[\u{26CE}]|[\u{26D4}]|[\u{26EA}]|[\u{26F2}-\u{26F3}]|[\u{26F5}]|[\u{26FA}]|[\u{26FD}]|[\u{2702}]|[\u{2705}]|[\u{2708}-\u{270D}]|[\u{270F}]|[\u{2712}]|[\u{2714}]|[\u{2716}]|[\u{271D}]|[\u{2721}]|[\u{2728}]|[\u{2733}-\u{2734}]|[\u{2744}]|[\u{2747}]|[\u{274C}]|[\u{274E}]|[\u{2753}-\u{2755}]|[\u{2757}]|[\u{2763}-\u{2764}]|[\u{2795}-\u{2797}]|[\u{27A1}]|[\u{27B0}]|[\u{27BF}]|[\u{2934}-\u{2935}]|[\u{2B05}-\u{2B07}]|[\u{2B1B}-\u{2B1C}]|[\u{3030}]|[\u{303D}]|[\u{3297}]|[\u{3299}]|[\u{1F004}]|[\u{1F170}-\u{1F171}]|[\u{1F17E}-\u{1F17F}]|[\u{1F18E}]|[\u{1F191}-\u{1F19A}]|[\u{1F1E0}-\u{1F1FF}]/gu;
            const emojis = text.match(emojiRegex) || [];
            if (emojis.length > 0) {
                patterns['Emojis'] = { count: emojis.length, weight: 5, category: 'emoji' };
                weightedScore += emojis.length * 5;
                totalPatterns += emojis.length;
            }

            // Calculate score (0-100)
            const score = words > 0 ? Math.min(100, Math.round((weightedScore / words) * 100)) : 0;

            return { patterns, score, total: totalPatterns };
        }

        function getCleanedText(text) {
            let cleaned = text;

            // Replace phrases (case-insensitive, preserve some capitalization)
            Object.entries(aiPatterns.replacements).forEach(([phrase, replacement]) => {
                const escaped = phrase.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp('\\b' + escaped + '\\b', 'gi');
                cleaned = cleaned.replace(regex, (match) => {
                    if (replacement === '') return '';
                    // Preserve capitalization of first letter
                    if (match[0] === match[0].toUpperCase()) {
                        return replacement.charAt(0).toUpperCase() + replacement.slice(1);
                    }
                    return replacement;
                });
            });

            // Remove emojis
            const emojiRegex = /[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F1FF}]|[\u{1F200}-\u{1F2FF}]|[\u{2B50}]|[\u{2B55}]|[\u{231A}-\u{231B}]|[\u{23E9}-\u{23F3}]|[\u{23F8}-\u{23FA}]|[\u{25AA}-\u{25AB}]|[\u{25B6}]|[\u{25C0}]|[\u{25FB}-\u{25FE}]|[\u{2614}-\u{2615}]|[\u{2648}-\u{2653}]|[\u{267F}]|[\u{2693}]|[\u{26A1}]|[\u{26AA}-\u{26AB}]|[\u{26BD}-\u{26BE}]|[\u{26C4}-\u{26C5}]|[\u{26CE}]|[\u{26D4}]|[\u{26EA}]|[\u{26F2}-\u{26F3}]|[\u{26F5}]|[\u{26FA}]|[\u{26FD}]|[\u{2702}]|[\u{2705}]|[\u{2708}-\u{270D}]|[\u{270F}]|[\u{2712}]|[\u{2714}]|[\u{2716}]|[\u{271D}]|[\u{2721}]|[\u{2728}]|[\u{2733}-\u{2734}]|[\u{2744}]|[\u{2747}]|[\u{274C}]|[\u{274E}]|[\u{2753}-\u{2755}]|[\u{2757}]|[\u{2763}-\u{2764}]|[\u{2795}-\u{2797}]|[\u{27A1}]|[\u{27B0}]|[\u{27BF}]|[\u{2934}-\u{2935}]|[\u{2B05}-\u{2B07}]|[\u{2B1B}-\u{2B1C}]|[\u{3030}]|[\u{303D}]|[\u{3297}]|[\u{3299}]|[\u{1F004}]|[\u{1F170}-\u{1F171}]|[\u{1F17E}-\u{1F17F}]|[\u{1F18E}]|[\u{1F191}-\u{1F19A}]|[\u{1F1E0}-\u{1F1FF}]/gu;
            cleaned = cleaned.replace(emojiRegex, '');

            // Remove em dashes if enabled
            if (detectEmDashes) {
                cleaned = cleaned.replace(/â€”/g, ' - '); // Replace with regular dash with spaces
            }

            // Clean up artifacts
            cleaned = cleaned.replace(/ {2,}/g, ' '); // Multiple spaces
            cleaned = cleaned.replace(/^\s+/gm, match => match.replace(/ +/g, '')); // Leading spaces (preserve newlines)
            cleaned = cleaned.replace(/ +([.,!?;:])/g, '$1'); // Space before punctuation
            cleaned = cleaned.replace(/([.,!?;:]) +([.,!?;:])/g, '$1$2'); // Double punctuation with space
            cleaned = cleaned.replace(/\n{3,}/g, '\n\n'); // Excessive newlines
            cleaned = cleaned.trim();

            return cleaned;
        }

        // ============================================
        // UI Updates
        // ============================================
        
        function updateScoreRing(score) {
            const circumference = 226;
            const offset = circumference - (score / 100) * circumference;
            scoreRing.style.strokeDashoffset = offset;
            
            scoreRing.classList.remove('low', 'medium', 'high');
            if (score < 20) {
                scoreRing.classList.add('low');
            } else if (score < 50) {
                scoreRing.classList.add('medium');
            } else {
                scoreRing.classList.add('high');
            }
        }

        function updateScoreLabel(score, hasText) {
            if (!hasText) {
                scoreLabel.textContent = 'Paste text to analyze';
                scoreDescription.textContent = 'We\'ll detect AI patterns and help you humanize your writing.';
            } else if (score < 20) {
                scoreLabel.textContent = 'Looks human';
                scoreDescription.textContent = 'Few AI patterns detected. Your text sounds natural.';
            } else if (score < 50) {
                scoreLabel.textContent = 'Some AI patterns';
                scoreDescription.textContent = 'We found patterns that could sound robotic. Consider cleaning.';
            } else {
                scoreLabel.textContent = 'Strong AI signals';
                scoreDescription.textContent = 'Multiple patterns detected. Humanizing is recommended.';
            }
        }

        function updatePatternsList(patterns) {
            const entries = Object.entries(patterns);
            patternCountEl.textContent = entries.reduce((sum, [_, data]) => sum + data.count, 0);
            
            if (entries.length === 0) {
                patternsEmpty.style.display = 'flex';
                patternsList.innerHTML = '';
                patternsList.appendChild(patternsEmpty);
            } else {
                patternsEmpty.style.display = 'none';
                patternsList.innerHTML = entries
                    .sort((a, b) => b[1].count * b[1].weight - a[1].count * a[1].weight)
                    .slice(0, 12)
                    .map(([phrase, data]) => `
                        <span class="pattern-tag" data-phrase="${phrase}">
                            ${phrase}
                            <span class="count">${data.count}</span>
                        </span>
                    `).join('');
            }
        }

        function highlightPatterns(text, patterns) {
            if (!isHighlighting || Object.keys(patterns).length === 0) {
                textDisplay.innerHTML = '';
                textInput.classList.remove('highlighting-active');
                return;
            }

            textInput.classList.add('highlighting-active');
            let highlighted = escapeHtml(text);

            // Build regex for all patterns
            const allPhrases = Object.keys(patterns).filter(p => !['Em dashes (â€”)', 'Colons before lists', 'Emojis'].includes(p));
            
            if (allPhrases.length > 0) {
                const phraseRegex = new RegExp(
                    '\\b(' + allPhrases.map(p => p.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|') + ')\\b',
                    'gi'
                );
                highlighted = highlighted.replace(phraseRegex, '<span class="pattern">$1</span>');
            }

            // Highlight em dashes
            if (patterns['Em dashes (â€”)']) {
                highlighted = highlighted.replace(/â€”/g, '<span class="pattern">â€”</span>');
            }

            // Highlight emojis
            if (patterns['Emojis']) {
                const emojiRegex = /[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu;
                highlighted = highlighted.replace(emojiRegex, '<span class="pattern">$&</span>');
            }

            textDisplay.innerHTML = highlighted;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        const updateStats = debounce(() => {
            const text = textInput.value;
            const stats = analyzeText(text);
            const detection = detectPatterns(text);
            
            currentDetection = detection;
            
            wordCountEl.textContent = stats.wordCount;
            charCountEl.textContent = stats.charCount;
            sentenceCountEl.textContent = stats.sentenceCount;
            readingTimeEl.textContent = stats.readingTime;
            aiScoreEl.textContent = detection.score;
            
            updateScoreRing(detection.score);
            updateScoreLabel(detection.score, text.trim().length > 0);
            updatePatternsList(detection.patterns);
            highlightPatterns(text, detection.patterns);
            
            // Update button states
            const hasText = text.trim().length > 0;
            const hasPatterns = detection.total > 0;
            cleanBtn.disabled = !hasPatterns;
            previewBtn.disabled = !hasPatterns;
            copyBtn.disabled = !hasText;
        }, 100);

        // ============================================
        // Event Handlers
        // ============================================
        
        textInput.addEventListener('input', updateStats);
        textInput.addEventListener('scroll', () => {
            textDisplay.scrollTop = textInput.scrollTop;
        });

        highlightToggle.addEventListener('click', () => {
            isHighlighting = !isHighlighting;
            highlightToggle.textContent = isHighlighting ? 'Hide in text' : 'Show in text';
            highlightPatterns(textInput.value, currentDetection.patterns);
        });

        // Em dash toggle handler
        emDashToggle.checked = detectEmDashes; // Initialize checkbox state
        emDashToggle.addEventListener('change', () => {
            detectEmDashes = emDashToggle.checked;
            localStorage.setItem('detectEmDashes', detectEmDashes);
            updateStats(); // Re-run detection with new setting
        });

        cleanBtn.addEventListener('click', () => {
            textBeforeClean = textInput.value;
            textInput.value = getCleanedText(textInput.value);
            updateStats();
            undoBtn.disabled = false;
        });

        previewBtn.addEventListener('click', () => {
            const original = textInput.value;
            cleanedText = getCleanedText(original);
            
            previewBefore.textContent = original;
            previewAfter.textContent = cleanedText;
            
            const beforeStats = analyzeText(original);
            const afterStats = analyzeText(cleanedText);
            const beforeDetection = detectPatterns(original);
            const afterDetection = detectPatterns(cleanedText);
            
            previewStats.textContent = `${beforeStats.wordCount} â†’ ${afterStats.wordCount} words | AI score: ${beforeDetection.score}% â†’ ${afterDetection.score}%`;
            
            previewOverlay.classList.add('active');
        });

        previewClose.addEventListener('click', () => previewOverlay.classList.remove('active'));
        previewCancel.addEventListener('click', () => previewOverlay.classList.remove('active'));
        
        previewApply.addEventListener('click', () => {
            textBeforeClean = textInput.value;
            textInput.value = cleanedText;
            updateStats();
            undoBtn.disabled = false;
            previewOverlay.classList.remove('active');
        });

        previewOverlay.addEventListener('click', (e) => {
            if (e.target === previewOverlay) previewOverlay.classList.remove('active');
        });

        undoBtn.addEventListener('click', () => {
            if (textBeforeClean) {
                textInput.value = textBeforeClean;
                textBeforeClean = '';
                updateStats();
                undoBtn.disabled = true;
            }
        });

        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(textInput.value);
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg> Copied';
                setTimeout(() => copyBtn.innerHTML = originalText, 2000);
            } catch (err) {
                console.error('Copy failed', err);
            }
        });

        clearBtn.addEventListener('click', () => {
            textInput.value = '';
            textBeforeClean = '';
            undoBtn.disabled = true;
            updateStats();
        });

        // ============================================
        // Text-to-Speech
        // ============================================
        
        let utterance = null;
        let words = [];
        let currentWordIndex = 0;
        let isPaused = false;
        let currentRate = 1;
        let voices = [];

        function loadVoices() {
            voices = speechSynthesis.getVoices();
            voiceSelect.innerHTML = '';
            voices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${voice.name} (${voice.lang})`;
                voiceSelect.appendChild(option);
            });
            
            const savedVoice = localStorage.getItem('preferredVoice');
            if (savedVoice && voices[savedVoice]) {
                voiceSelect.value = savedVoice;
            }
        }

        speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();

        const savedSpeed = localStorage.getItem('preferredSpeed');
        if (savedSpeed) {
            currentRate = parseFloat(savedSpeed);
            speedBtns.forEach(btn => {
                btn.classList.toggle('active', parseFloat(btn.dataset.speed) === currentRate);
            });
        }

        voiceSelect.addEventListener('change', () => {
            localStorage.setItem('preferredVoice', voiceSelect.value);
        });

        speedBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                currentRate = parseFloat(btn.dataset.speed);
                localStorage.setItem('preferredSpeed', currentRate);
                speedBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if (utterance && speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                    if (!isPaused) speakFromWord(currentWordIndex);
                }
            });
        });

        function highlightSpeechWord(index) {
            const text = textInput.value;
            const wordArray = text.split(/(\s+)/);
            let actualWordIndex = 0;
            let result = '';

            for (let i = 0; i < wordArray.length; i++) {
                if (wordArray[i].trim().length > 0) {
                    if (actualWordIndex === index) {
                        result += `<span class="speech-highlight">${escapeHtml(wordArray[i])}</span>`;
                    } else {
                        result += escapeHtml(wordArray[i]);
                    }
                    actualWordIndex++;
                } else {
                    result += escapeHtml(wordArray[i]);
                }
            }

            textInput.classList.add('highlighting-active');
            textDisplay.innerHTML = result;
        }

        function clearSpeechHighlight() {
            textInput.classList.remove('highlighting-active');
            if (isHighlighting) {
                highlightPatterns(textInput.value, currentDetection.patterns);
            } else {
                textDisplay.innerHTML = '';
            }
        }

        function speakFromWord(startIndex) {
            const text = textInput.value;
            if (!text.trim()) return;

            words = text.split(/\s+/).filter(w => w.trim().length > 0);
            currentWordIndex = startIndex;

            const textToSpeak = words.slice(startIndex).join(' ');
            utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.rate = currentRate;

            if (voiceSelect.value && voices[voiceSelect.value]) {
                utterance.voice = voices[voiceSelect.value];
            }

            let wordCount = startIndex;
            utterance.onboundary = (event) => {
                if (event.name === 'word') {
                    highlightSpeechWord(wordCount);
                    currentWordIndex = wordCount;
                    wordCount++;
                }
            };

            utterance.onend = () => {
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                clearSpeechHighlight();
                isPaused = false;
                currentWordIndex = 0;
            };

            speechSynthesis.speak(utterance);
            playBtn.disabled = true;
            pauseBtn.disabled = false;
            stopBtn.disabled = false;
        }

        playBtn.addEventListener('click', () => {
            if (isPaused) {
                speechSynthesis.resume();
                isPaused = false;
                playBtn.disabled = true;
                pauseBtn.disabled = false;
            } else {
                speakFromWord(0);
            }
        });

        pauseBtn.addEventListener('click', () => {
            if (speechSynthesis.speaking) {
                speechSynthesis.pause();
                isPaused = true;
                playBtn.disabled = false;
                pauseBtn.disabled = true;
            }
        });

        stopBtn.addEventListener('click', () => {
            speechSynthesis.cancel();
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
            clearSpeechHighlight();
            isPaused = false;
            currentWordIndex = 0;
        });

        // Initialize
        updateStats();
    </script>
</body>
</html>
